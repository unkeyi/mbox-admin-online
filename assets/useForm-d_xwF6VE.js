var He=Object.defineProperty;var be=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var we=(s,c,r)=>c in s?He(s,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[c]=r,j=(s,c)=>{for(var r in c||(c={}))We.call(c,r)&&we(s,r,c[r]);if(be)for(var r of be(c))Ye.call(c,r)&&we(s,r,c[r]);return s};var y=(s,c,r)=>new Promise((i,A)=>{var v=u=>{try{l(r.next(u))}catch(d){A(d)}},t=u=>{try{l(r.throw(u))}catch(d){A(d)}},l=u=>u.done?i(u.value):Promise.resolve(u.value).then(v,t);l((r=r.apply(s,c)).next())});import{u as n,c as q,w as Z,ap as Xe,g as ke,y as me,J as Ve,h as qe,d as ze,K as Ge,r as Te,f as z,o as Je,Z as he,a8 as Be,a9 as le,k as Ie,ae as ue,_ as Ze,aa as ye,ad as De,ac as Ae,F as Qe,aj as Ee,ak as Se,ao as Me,b as et}from"./vue-2VIvd4_n.js";import{_ as tt}from"./FormItem.vue_vue_type_script_lang-DREqDe1Q.js";import{b as nt,c as st,_ as at}from"./BasicForm.vue_vue_type_style_index_0_lang-CK1aU-F6.js";import{u as rt,i as fe,d as xe,a as it}from"./helper-gNcPrHqV.js";import{x as Y,aw as G,aT as X,au as ot,A as je,aE as de,d as $e,f as ct,ar as lt,aD as ut}from"./entry/index-CFS-oRkL.js";import{e as te,l as pe,s as M,ad as Q,aS as Oe,d as J,v as _e,f as ee,a9 as ft,U as Pe,aT as dt,$ as pt,a8 as mt,a5 as ht}from"./antd-DYfcSfab.js";import{a as yt}from"./index-DhOZVxC3.js";function At(s,c,r){const i=/^\[(.+)\]$/;if(i.test(s)){const A=s.match(i);if(A&&A[1]){const v=A[1].split(",");return c=Array.isArray(c)?c:[c],v.forEach((t,l)=>{M(r,t.trim(),c[l])}),!0}}}function vt(s,c,r){const i=/^\{(.+)\}$/;if(i.test(s)){const A=s.match(i);if(A&&A[1]){const v=A[1].split(",");return c=Y(c)?c:{},v.forEach(t=>{M(r,t.trim(),c[t.trim()])}),!0}}}function Ft({defaultValueRef:s,getSchema:c,formModel:r,getProps:i}){function A(u){var w,O;if(!Y(u))return{};const d={};for(const E of Object.entries(u)){let[,f]=E;const[D]=E;if(!D||G(f)&&f.length===0||te(f))continue;const p=n(i).transformDateFunc;Y(f)&&(f=p==null?void 0:p(f)),G(f)&&((w=f[0])!=null&&w.format)&&((O=f[1])!=null&&O.format)&&(f=f.map(F=>p==null?void 0:p(F))),pe(f)&&(f=f.trim()),!At(D,f,d)&&!vt(D,f,d)&&M(d,D,f)}return v(d)}function v(u){const d=n(i).fieldMapToTime;if(!d||!Array.isArray(d))return u;for(const[w,[O,E],f="YYYY-MM-DD"]of d){if(!w||!O||!E)continue;if(!Q(u,w)){Oe(u,w);continue}const[D,p]=Q(u,w),[F,V]=Array.isArray(f)?f:[f,f];!J(D)&&!_e(D)&&M(u,O,t(D,F)),!J(p)&&!_e(p)&&M(u,E,t(p,V)),Oe(u,w)}return u}function t(u,d){return d==="timestamp"?X(u).unix():d==="timestampStartDay"?X(u).startOf("day").unix():X(u).format(d)}function l(){const u=n(c),d={};u.forEach(w=>{const{defaultValue:O,defaultValueObj:E,componentProps:f={}}=w,D=Object.keys(E||{});D.length&&D.forEach(p=>{d[p]=E[p],r[p]===void 0&&(r[p]=E[p])}),J(O)||(d[w.field]=O,r[w.field]===void 0&&(r[w.field]=O)),J(f==null?void 0:f.defaultValue)||(d[w.field]=f==null?void 0:f.defaultValue,r[w.field]===void 0&&(r[w.field]=f==null?void 0:f.defaultValue))}),s.value=ee(d)}return{handleFormValues:A,initDefault:l}}const k=24;function gt({advanceState:s,emit:c,getProps:r,getSchema:i,formModel:A,defaultValueRef:v}){const t=ke(),{realWidthRef:l,screenEnum:u,screenRef:d}=ot(),w=q(()=>{if(!s.isAdvanced)return 0;const F=n(r).emptySpan||0;if(ft(F))return F;if(Y(F)){const{span:V=0}=F,C=n(d);return F[C.toLowerCase()]||V||0}return 0}),O=je(D,30);Z([()=>n(i),()=>s.isAdvanced,()=>n(l)],()=>{const{showAdvancedButton:F}=n(r);F&&O()},{immediate:!0});function E(F,V=0,C=!1){const _=n(l),x=parseInt(F.md)||parseInt(F.xs)||parseInt(F.sm)||F.span||k,U=parseInt(F.lg)||x,$=parseInt(F.xl)||U,N=parseInt(F.xxl)||$;return _<=u.LG?V+=x:_<u.XL?V+=U:_<u.XXL?V+=$:V+=N,C?(s.hideAdvanceBtn=!1,V<=k*2?(s.hideAdvanceBtn=!0,s.isAdvanced=!0):V>k*2&&V<=k*(n(r).autoAdvancedLine||3)?s.hideAdvanceBtn=!1:s.isLoad||(s.isLoad=!0,s.isAdvanced=!s.isAdvanced),{isAdvanced:s.isAdvanced,itemColSum:V}):V>k*(n(r).alwaysShowLines||1)?{isAdvanced:s.isAdvanced,itemColSum:V}:{isAdvanced:!0,itemColSum:V}}const f=Xe({});function D(){var _;let F=0,V=0;const{baseColProps:C={}}=n(r);for(const x of n(i)){const{show:U,ifShow:$,colProps:N}=x,H={schema:x,model:A,field:x.field,values:j(j({},n(v)),A)};let P=!0;if(P&&Pe($)&&(P=$),P&&te($)&&(P=$(H)),P&&Pe(U)&&(P=U),P&&te(U)&&(P=U(H)),P&&(N||C)){const{itemColSum:ne,isAdvanced:e}=E(j(j({},C),N),F);F=ne||0,e&&(V=F),f[x.field]=e}}(_=t==null?void 0:t.proxy)==null||_.$forceUpdate(),s.actionSpan=V%k+n(w),E(n(r).actionColOptions||{span:k},F,!0),c("advanced-change",s.isAdvanced)}function p(){s.isAdvanced=!s.isAdvanced}return{handleToggleAdvanced:p,fieldsIsAdvancedMap:f}}function Le(s){return rt.includes(s)}function bt(s,c={}){const r=/^\[(.+)\]$/;if(r.test(s)){const i=s.match(r);if(i&&i[1]){const A=i[1].split(",");if(!A.length)return;const v=[];return A.forEach((t,l)=>{M(v,l,c[t.trim()])}),v.filter(Boolean).length?v:void 0}}}function wt({emit:s,getProps:c,formModel:r,getSchema:i,defaultValueRef:A,formElRef:v,schemaRef:t,handleFormValues:l}){function u(){return y(this,null,function*(){const{resetFunc:e,submitOnReset:o}=n(c);e&&te(e)&&(yield e()),n(v)&&(Object.keys(r).forEach(a=>{const g=n(i).find(B=>B.field===a),T=g==null?void 0:g.defaultValueObj,L=Object.keys(T||{});L.length&&L.forEach(B=>{r[B]=T[B]}),r[a]=Vt(g,A,a)}),me(()=>N()),s("reset",Ve(r)),o&&P())})}const d=()=>n(i).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function w(e){return y(this,null,function*(){if(Object.keys(e).length===0)return;const o=d(),m=[];o.forEach(a=>{const g=n(i).find(I=>I.field===a),T=Q(e,a),L=dt(e,a),{componentProps:B}=g||{};let R=B;typeof B=="function"&&(R=R({formModel:n(r),formActionType:ne}));let W;const re=I=>I?R!=null&&R.valueFormat?I:X(I):null;if(_(g==null?void 0:g.component)&&(W=bt(a,e),W)){const I=W||T;if(Array.isArray(I)){const ie=[];for(const se of I)ie.push(re(se));n(r)[a]=ie,m.push(a)}else n(r)[a]=re(I),m.push(a)}if(Le(g==null?void 0:g.component)){W=Q(T,a);const I=W||T;I&&(G(I)?n(r)[a]=I:typeof I=="string"&&(n(r)[a]=[I])),m.push(a);return}if(L){W=Q(T,a);const I=W||T;n(r)[a]=I,R!=null&&R.onChange&&(R==null||R.onChange(I)),m.push(a)}}),x(m).catch(a=>{})})}function O(e){if(!Array.isArray(e)||Array.isArray(e)&&e.length===0)return;const o=[],m=Object.keys(n(r));m&&(e.forEach(a=>{m.includes(a)&&(o.push(a),n(r)[a]=ee(n(Q(A.value,a))))}),x(o).catch(a=>{}))}function E(e){return y(this,null,function*(){const o=ee(n(i));if(!e)return;let m=pe(e)?[e]:e;pe(e)&&(m=[e]);for(const a of m)f(a,o);t.value=o})}function f(e,o){if(pe(e)){const m=o.findIndex(a=>a.field===e);m!==-1&&(delete r[e],o.splice(m,1))}}function D(e,o,m=!1){return y(this,null,function*(){const a=ee(n(i)),g=Array.isArray(e)?e.map(B=>B.field):[e.field];if(a.find(B=>g.includes(B.field))){de("There are schemas that have already been added");return}const T=a.findIndex(B=>B.field===o),L=Y(e)?[e]:e;!o||T===-1||m?m?a.unshift(...L):a.push(...L):T!==-1&&a.splice(T+1,0,...L),t.value=a,V(e)})}function p(e){return y(this,null,function*(){let o=[];if(Y(e)&&o.push(e),G(e)&&(o=[...e]),!o.every(a=>fe(a.component)||Reflect.has(a,"field")&&a.field)){de("All children of the form Schema array that need to be updated must contain the `field` field");return}t.value=o})}function F(e){return y(this,null,function*(){let o=[];if(Y(e)&&o.push(e),G(e)&&(o=[...e]),!o.every(T=>fe(T.component)||Reflect.has(T,"field")&&T.field)){de("All children of the form Schema array that need to be updated must contain the `field` field");return}const a=[],g=[];n(i).forEach(T=>{const L=o.find(B=>T.field===B.field);if(L){const B=$e(T,L);g.push(B),a.push(B)}else a.push(T)}),V(g),t.value=pt(a,"field")})}function V(e){let o=[];Y(e)&&o.push(e),G(e)&&(o=[...e]);const m={},a=C();o.forEach(g=>{!fe(g.component)&&Reflect.has(g,"field")&&g.field&&!J(g.defaultValue)&&(!(g.field in a)||J(a[g.field]))&&(m[g.field]=g.defaultValue)}),w(m)}function C(){return n(v)?l(Ve(n(r))):{}}function _(e){return xe.includes(e)}function x(e){return y(this,null,function*(){var m;const o=yield(m=n(v))==null?void 0:m.validateFields(e);return l(o)})}function U(e){return y(this,null,function*(){var o;yield(o=n(v))==null?void 0:o.setProps(e)})}function $(e){return y(this,null,function*(){var a;let o;e===void 0?o=d():o=e===Array.isArray(e)?e:void 0;const m=yield(a=n(v))==null?void 0:a.validate(o);return l(m)})}function N(e){return y(this,null,function*(){var o;yield(o=n(v))==null?void 0:o.clearValidate(e)})}function H(e,o){return y(this,null,function*(){var m;yield(m=n(v))==null?void 0:m.scrollToField(e,o)})}function P(e){return y(this,null,function*(){e&&e.preventDefault();const{submitFunc:o}=n(c);if(o&&te(o)){yield o();return}if(n(v))try{const a=yield $();s("submit",a)}catch(a){if((a==null?void 0:a.outOfDate)===!1&&(a!=null&&a.errorFields))return;throw new Error(a)}})}const ne={getFieldsValue:C,setFieldsValue:w,resetFields:u,updateSchema:F,resetSchema:p,setProps:U,removeSchemaByField:E,appendSchemaByField:D,clearValidate:N,validateFields:x,validate:$,submit:P,scrollToField:H};return{handleSubmit:P,clearValidate:N,validate:$,validateFields:x,getFieldsValue:C,updateSchema:F,resetSchema:p,appendSchemaByField:D,removeSchemaByField:E,resetFields:u,setFieldsValue:w,scrollToField:H,resetDefaultField:O}}function Vt(s,c,r){let i=ee(c.value[r]);return Bt(s)?J(i)?void 0:i:(!i&&s&&Tt(s)&&(i=[0,0]),!i&&s&&s.component==="ApiTree"&&(i=[]),i)}function Tt(s){if(s.component==="Slider"&&s.componentProps&&"range"in s.componentProps)return!0}function Bt(s){return(s==null?void 0:s.component)&&it.includes(s.component)}function It(A){return y(this,arguments,function*({getSchema:s,getProps:c,formElRef:r,isInitedDefault:i}){qe(()=>y(this,null,function*(){if(n(i)||!n(c).autoFocusFirstItem)return;yield me();const v=n(s),t=n(r),l=t==null?void 0:t.$el;if(!t||!l||!v||v.length===0)return;const u=v[0];if(!u.component||!u.component.includes("Input"))return;const d=l.querySelector(".ant-row:first-child input");d&&(d==null||d.focus())}))})}const $t=ze({name:"BasicForm",__name:"BasicForm",props:nt,emits:["advanced-change","reset","submit","register","field-value-change"],setup(s,{expose:c,emit:r}){const i=s,A=r,v=Ge(),t=Te({}),l=yt(),u=Te({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),d=z({}),w=z(!1),O=z(),E=z(null),f=z(null),{prefixCls:D}=ct("basic-form"),p=q(()=>j(j({},i),n(O))),F=q(()=>[D,{[`${D}--compact`]:n(p).compact}]),V=q(()=>{const{baseRowStyle:h={},rowProps:K}=n(p);return j({style:h},K)}),C=q(()=>j(j(j({},v),i),n(p))),_=q(()=>{var K;const h=ee(n(E)||n(p).schemas);for(const b of h){const{defaultValue:S,component:ae,componentProps:oe={},isHandleDateDefaultValue:Ke=!0,field:Ce,isHandleDefaultValue:Ue=!0,valueFormat:ve}=b;if(Ke&&S&&ae&&xe.includes(ae)){const Ne={schema:b,tableAction:(K=i.tableAction)!=null?K:{},formModel:t,formActionType:{}},ce=oe?typeof oe=="function"?oe(Ne).valueFormat:oe.valueFormat:null;if(!Array.isArray(S))b.defaultValue=ce?X(S).format(ce):X(S);else{const Fe=[];S.forEach(ge=>{Fe.push(ce?X(ge).format(ce):X(ge))}),b.defaultValue=Fe}}S&&Le(b==null?void 0:b.component)&&(G(S)?b.defaultValue=S:typeof S=="string"&&(b.defaultValue=[S])),Ue&&S&&ae&&te(ve)&&(b.defaultValue=ve({value:S,schema:b,model:t,field:Ce}))}return n(p).showAdvancedButton?h.filter(b=>!fe(b.component)):h}),{handleToggleAdvanced:x,fieldsIsAdvancedMap:U}=gt({advanceState:u,emit:A,getProps:p,getSchema:_,formModel:t,defaultValueRef:d}),{handleFormValues:$,initDefault:N}=Ft({getProps:p,defaultValueRef:d,getSchema:_,formModel:t});It({getSchema:_,getProps:p,isInitedDefault:w,formElRef:f});const{handleSubmit:H,setFieldsValue:P,clearValidate:ne,validate:e,validateFields:o,getFieldsValue:m,updateSchema:a,resetSchema:g,appendSchemaByField:T,removeSchemaByField:L,resetFields:B,scrollToField:R,resetDefaultField:W}=wt({emit:A,getProps:p,formModel:t,getSchema:_,defaultValueRef:d,formElRef:f,schemaRef:E,handleFormValues:$});st({resetAction:B,submitAction:H}),Z(()=>n(p).model,()=>{const{model:h}=n(p);h&&P(h)},{immediate:!0}),Z(()=>i.schemas,h=>{g(h!=null?h:[])}),Z(()=>_.value,h=>{me(()=>{var K;(K=l==null?void 0:l.redoModalHeight)==null||K.call(l)}),!n(w)&&h!=null&&h.length&&(N(),w.value=!0)}),Z(()=>t,je(()=>{n(p).submitOnChange&&H()},300),{deep:!0});function re(h){return y(this,null,function*(){O.value=$e(n(O)||{},h)})}function I(h,K,b){t[h]=K,A("field-value-change",h,K),b&&b.itemProps&&!b.itemProps.autoLink&&o([h]).catch(S=>{})}function ie(h){const{autoSubmitOnEnter:K}=n(p);if(K&&h.key==="Enter"&&h.target&&h.target instanceof HTMLElement){const b=h.target;b&&b.tagName&&b.tagName.toUpperCase()==="INPUT"&&H()}}const se={getFieldsValue:m,setFieldsValue:P,resetFields:B,updateSchema:a,resetSchema:g,setProps:re,removeSchemaByField:L,appendSchemaByField:T,clearValidate:ne,validateFields:o,validate:e,submit:H,scrollToField:R,resetDefaultField:W},Re=q(()=>j(j({},p.value),u));return c(j({},se)),Je(()=>{N(),A("register",se)}),(h,K)=>(he(),Be(n(ht),Ae(C.value,{class:F.value,ref_key:"formElRef",ref:f,model:t,onKeypress:Me(ie,["enter"])}),{default:le(()=>[Ie(n(mt),Ee(Se(V.value)),{default:le(()=>[ue(h.$slots,"formHeader"),(he(!0),Ze(Qe,null,ye(_.value,b=>(he(),Be(tt,{key:b.field,isAdvanced:n(U)[b.field],tableAction:h.tableAction,formActionType:se,schema:b,formProps:p.value,allDefaultValues:d.value,formModel:t,setFormModel:I},De({_:2},[ye(Object.keys(h.$slots),S=>({name:S,fn:le(ae=>[ue(h.$slots,S,Ae({ref_for:!0},ae||{}))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Ie(at,Ae(Re.value,{onToggleAdvanced:n(x)}),De({_:2},[ye(["resetBefore","submitBefore","advanceBefore","advanceAfter"],b=>({name:b,fn:le(S=>[ue(h.$slots,b,Ee(Se(S||{})))])}))]),1040,["onToggleAdvanced"]),ue(h.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});function Lt(s){const c=z(null),r=z(!1);function i(){return y(this,null,function*(){const t=n(c);return t||de("The form instance has not been obtained, please make sure that the form has been rendered when performing the form operation!"),yield me(),t})}function A(t){et(()=>{c.value=null,r.value=null}),!(n(r)&&lt()&&t===n(c))&&(c.value=t,r.value=!0,Z(()=>s,()=>{s&&t.setProps(ut(s))},{immediate:!0,deep:!0}))}return[A,{scrollToField:(t,l)=>y(this,null,function*(){(yield i()).scrollToField(t,l)}),setProps:t=>y(this,null,function*(){(yield i()).setProps(t)}),updateSchema:t=>y(this,null,function*(){(yield i()).updateSchema(t)}),resetSchema:t=>y(this,null,function*(){(yield i()).resetSchema(t)}),clearValidate:t=>y(this,null,function*(){(yield i()).clearValidate(t)}),resetFields:()=>new Promise(t=>{i().then(l=>y(this,null,function*(){yield l.resetFields(),t()}))}),removeSchemaByField:t=>y(this,null,function*(){var l;(l=n(c))==null||l.removeSchemaByField(t)}),getFieldsValue:()=>{var t;return(t=n(c))==null?void 0:t.getFieldsValue()},setFieldsValue:t=>y(this,null,function*(){(yield i()).setFieldsValue(t)}),appendSchemaByField:(t,l,u)=>y(this,null,function*(){(yield i()).appendSchemaByField(t,l,u)}),submit:()=>y(this,null,function*(){return(yield i()).submit()}),validate:t=>y(this,null,function*(){return(yield i()).validate(t)}),validateFields:t=>y(this,null,function*(){return(yield i()).validateFields(t)}),resetDefaultField:t=>y(this,null,function*(){var l;(l=n(c))==null||l.resetDefaultField(t)})}]}export{$t as _,Lt as u};
