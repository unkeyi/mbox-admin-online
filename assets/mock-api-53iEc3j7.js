var J=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var U=Math.pow,F=(t,e,n)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,w=(t,e)=>{for(var n in e||(e={}))_.call(e,n)&&F(t,n,e[n]);if(S)for(var n of S(e))D.call(e,n)&&F(t,n,e[n]);return t},H=(t,e)=>Q(t,X(e));var y=(t,e)=>{var n={};for(var i in t)_.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&S)for(var i of S(t))e.indexOf(i)<0&&D.call(t,i)&&(n[i]=t[i]);return n};var T=(t,e,n)=>F(t,typeof e!="symbol"?e+"":e,n);var B=(t,e,n)=>new Promise((i,r)=>{var o=c=>{try{s(n.next(c))}catch(f){r(f)}},u=c=>{try{s(n.throw(c))}catch(f){r(f)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(o,u);s((n=n.apply(t,e)).next())});import{f as v,w as M,u as P,h as R,b as j,c as Y,r as Z,o as G,I as W}from"./vue-2VIvd4_n.js";import{aa as k,bc as K}from"./antd-DYfcSfab.js";import{bf as V}from"./entry/index-CFS-oRkL.js";const z=(t,{manual:e,ready:n=!0,defaultParams:i=[],refreshDeps:r=[],refreshDepsAction:o})=>{const u=v(!1);return M(()=>P(n),s=>{!P(e)&&s&&(u.value=!0,t.run(...i))}),r.length&&M(r,()=>{u.value||e||(o?o():t.refresh())}),{onBefore:()=>{if(!P(n))return{stopNow:!0}}}};z.onInit=({ready:t=!0,manual:e})=>({loading:!P(e)&&P(t)});const p=new Map,I=(t,e,n)=>{const i=p.get(t);i!=null&&i.timer&&clearTimeout(i.timer);let r;e>-1&&(r=setTimeout(()=>{p.delete(t)},e)),p.set(t,H(w({},n),{timer:r}))},ee=t=>p.get(t),Oe=t=>{t?(Array.isArray(t)?t:[t]).forEach(n=>p.delete(n)):p.clear()},E=new Map,te=t=>E.get(t),ne=(t,e)=>{E.set(t,e),e.then(n=>(E.delete(t),n)).catch(()=>{E.delete(t)})},g={},ie=(t,e)=>{g[t]&&g[t].forEach(n=>n(e))},x=(t,e)=>(g[t]||(g[t]=[]),g[t].push(e),function(){const i=g[t].indexOf(e);g[t].splice(i,1)}),se=(t,{cacheKey:e,cacheTime:n=5*60*1e3,staleTime:i=0,setCache:r,getCache:o})=>{const u=v(),s=v(),c=(a,l)=>{r?r(l):I(a,n,l),ie(a,l.data)},f=(a,l=[])=>o?o(l):ee(a);return R(()=>{if(!e)return;const a=f(e);a&&Object.hasOwnProperty.call(a,"data")&&(t.state.data=a.data,t.state.params=a.params,(i===-1||new Date().getTime()-a.time<=i)&&(t.state.loading=!1)),u.value=x(e,l=>{t.setState({data:l})})}),j(()=>{var a;(a=u.value)==null||a.call(u)}),e?{onBefore:a=>{const l=f(e,a);return!l||!Object.hasOwnProperty.call(l,"data")?{}:i===-1||new Date().getTime()-l.time<=i?{loading:!1,data:l==null?void 0:l.data,error:void 0,returnNow:!0}:{data:l==null?void 0:l.data,error:void 0}},onRequest:(a,l)=>{let d=te(e);return d&&d!==s.value?{servicePromise:d}:(d=a(...l),s.value=d,ne(e,d),{servicePromise:d})},onSuccess:(a,l)=>{var d;e&&((d=u.value)==null||d.call(u),c(e,{data:a,params:l,time:new Date().getTime()}),u.value=x(e,O=>{t.setState({data:O})}))},onMutate:a=>{var l;e&&((l=u.value)==null||l.call(u),c(e,{data:a,params:t.state.params,time:new Date().getTime()}),u.value=x(e,d=>{t.setState({data:d})}))}}:{}},re=(t,{debounceWait:e,debounceLeading:n,debounceTrailing:i,debounceMaxWait:r})=>{const o=v(),u=Y(()=>{const s={};return n!==void 0&&(s.leading=n),i!==void 0&&(s.trailing=i),r!==void 0&&(s.maxWait=r),s});return R(()=>{if(e){const s=t.runAsync.bind(t);return o.value=k(c=>{c()},e,u.value),t.runAsync=(...c)=>new Promise((f,a)=>{var l;(l=o.value)==null||l.call(o,()=>{s(...c).then(f).catch(a)})}),()=>{var c;(c=o.value)==null||c.cancel(),t.runAsync=s}}}),e?{onCancel:()=>{var s;(s=o.value)==null||s.cancel()}}:{}},oe=(t,{loadingDelay:e,ready:n})=>{const i=v();if(!e)return{};const r=()=>{i.value&&clearTimeout(i.value)};return{onBefore:()=>(r(),P(n)!==!1&&(i.value=setTimeout(()=>{t.setState({loading:!0})},e)),{loading:!1}),onFinally:()=>{r()},onCancel:()=>{r()}}},C=!!(typeof window!="undefined"&&window.document&&window.document.createElement);function $(){return C?document.visibilityState!=="hidden":!0}const b=[];if(C){const t=()=>{if($())for(let e=0;e<b.length;e++){const n=b[e];n()}};window.addEventListener("visibilitychange",t,!1)}function ue(t){return b.push(t),function(){const n=b.indexOf(t);b.splice(n,1)}}const ae=(t,{pollingInterval:e,pollingWhenHidden:n=!0,pollingErrorRetryCount:i=-1})=>{const r=v(),o=v(),u=v(0),s=()=>{var c;r.value&&clearTimeout(r.value),(c=o.value)==null||c.call(o)};return M(()=>e,()=>{e||s()}),e?{onBefore:()=>{s()},onError:()=>{u.value+=1},onSuccess:()=>{u.value=0},onFinally:()=>{i===-1||i!==-1&&u.value<=i?r.value=setTimeout(()=>{!n&&!$()?o.value=ue(()=>{t.refresh()}):t.refresh()},e):u.value=0},onCancel:()=>{s()}}:{}};function le(t,e){let n=!1;return(...i)=>{n||(n=!0,t(...i),setTimeout(()=>{n=!1},e))}}function ce(){return C&&typeof navigator.onLine!="undefined"?navigator.onLine:!0}const A=[];if(C){const t=()=>{if(!(!$()||!ce()))for(let e=0;e<A.length;e++){const n=A[e];n()}};window.addEventListener("visibilitychange",t,!1),window.addEventListener("focus",t,!1)}function fe(t){return A.push(t),function(){const n=A.indexOf(t);n>-1&&A.splice(n,1)}}const de=(t,{refreshOnWindowFocus:e,focusTimespan:n=5e3})=>{const i=v(),r=()=>{var o;(o=i.value)==null||o.call(i)};return R(()=>{if(e){const o=le(t.refresh.bind(t),n);i.value=fe(()=>{o()})}return()=>{r()}}),j(()=>{r()}),{}},ve=(t,{retryInterval:e,retryCount:n})=>{const i=v(),r=v(0),o=v(!1);return n?{onBefore:()=>{o.value||(r.value=0),o.value=!1,i.value&&clearTimeout(i.value)},onSuccess:()=>{r.value=0},onError:()=>{if(r.value+=1,n===-1||r.value<=n){const u=e!=null?e:Math.min(1e3*U(2,r.value),3e4);i.value=setTimeout(()=>{o.value=!0,t.refresh()},u)}else r.value=0},onCancel:()=>{r.value=0,i.value&&clearTimeout(i.value)}}:{}},me=(t,{throttleWait:e,throttleLeading:n,throttleTrailing:i})=>{const r=v(),o={};return n!==void 0&&(o.leading=n),i!==void 0&&(o.trailing=i),R(()=>{if(e){const u=t.runAsync.bind(t);return r.value=K(s=>{s()},e,o),t.runAsync=(...s)=>new Promise((c,f)=>{var a;(a=r.value)==null||a.call(r,()=>{u(...s).then(c).catch(f)})}),()=>{var s;t.runAsync=u,(s=r.value)==null||s.cancel()}}}),e?{onCancel:()=>{var u;(u=r.value)==null||u.cancel()}}:{}},ge=t=>typeof t=="function";class he{constructor(e,n,i,r={}){T(this,"pluginImpls",[]);T(this,"count",0);T(this,"state",Z({loading:!1,params:void 0,data:void 0,error:void 0}));this.serviceRef=e,this.options=n,this.subscribe=i,this.initState=r,this.setState(w({loading:!n.manual},r))}setState(e={}){Object.assign(this.state,e),this.subscribe()}runPluginHandler(e,...n){const i=this.pluginImpls.map(r=>{var o;return(o=r[e])==null?void 0:o.call(r,...n)}).filter(Boolean);return Object.assign({},...i)}runAsync(...e){return B(this,null,function*(){var s,c,f,a,l,d,O,q,L,N;this.count+=1;const n=this.count,u=this.runPluginHandler("onBefore",e),{stopNow:i=!1,returnNow:r=!1}=u,o=y(u,["stopNow","returnNow"]);if(i)return new Promise(()=>{});if(this.setState(w({loading:!0,params:e},o)),r)return Promise.resolve(o.data);(c=(s=this.options).onBefore)==null||c.call(s,e);try{let{servicePromise:m}=this.runPluginHandler("onRequest",this.serviceRef,e);m||(m=this.serviceRef(...e));const h=yield m;return n!==this.count?new Promise(()=>{}):(this.setState({data:h,error:void 0,loading:!1}),(a=(f=this.options).onSuccess)==null||a.call(f,h,e),this.runPluginHandler("onSuccess",h,e),(d=(l=this.options).onFinally)==null||d.call(l,e,h,void 0),n===this.count&&this.runPluginHandler("onFinally",e,h,void 0),h)}catch(m){if(n!==this.count)return new Promise(()=>{});throw this.setState({error:m,loading:!1}),(q=(O=this.options).onError)==null||q.call(O,m,e),this.runPluginHandler("onError",m,e),(N=(L=this.options).onFinally)==null||N.call(L,e,void 0,m),n===this.count&&this.runPluginHandler("onFinally",e,void 0,m),m}})}run(...e){this.runAsync(...e).catch(n=>{this.options.onError})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const n=ge(e)?e(this.state.data):e;this.runPluginHandler("onMutate",n),this.setState({data:n})}}function we(t,e={},n=[]){const c=e,{manual:i=!1}=c,r=y(c,["manual"]),o=w({manual:i},r),u=n.map(f=>{var a;return(a=f==null?void 0:f.onInit)==null?void 0:a.call(f,o)}).filter(Boolean),s=new he(t,o,()=>{},Object.assign({},...u));return s.options=o,s.pluginImpls=n.map(f=>f(s,o)),G(()=>{if(!i){const f=s.state.params||e.defaultParams||[];s.run(...f)}}),j(()=>{s.cancel()}),H(w({},W(s.state)),{cancel:s.cancel.bind(s),mutate:s.mutate.bind(s),refresh:s.refresh.bind(s),refreshAsync:s.refreshAsync.bind(s),run:s.run.bind(s),runAsync:s.runAsync.bind(s)})}function Se(t,e,n){return we(t,e,[re,oe,ae,de,me,z,se,ve])}function Te(t,e=!0){return B(this,null,function*(){return new Promise((n,i)=>{setTimeout(()=>{e?n(t!=null?t:V.mock("@name")):i(new Error(`Failed to modify username: ${t}`))},1250)})})}function Be(t){return B(this,null,function*(){return new Promise(e=>{setTimeout(()=>{e({data:V.mock("@paragraph"),time:new Date().getTime(),keyword:t})},1e3)})})}export{Oe as c,Be as g,Te as i,Se as u};
